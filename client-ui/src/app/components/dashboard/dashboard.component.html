<!--
  ~ Copyright 2019 ABSA Group Limited
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->
<div *ngIf="dashboardState.filters.dateRange" class="filters mo-padding">
  <time-frame-picker (rangeChange)="onDateRangeSelected($event)" [rangeBoundaries]="executionEvents.totalDateRange"
                     [range]="dashboardState.filters.dateRange">
  </time-frame-picker>
</div>
<div class="container-fluid">
  <div class="row">
    <div class="col-md-12">
      <input #searchInput (keyup)="onSearchTermChange($event)" class="search float-right" placeholder="Search..."
             type="text" value="{{dashboardState.filters.searchQuery}}"/>

      <div class="dataMode float-left">
        Filter by Date/Time &nbsp;
        <mat-slide-toggle (change)="onFilterByDateSwitchToggle($event)" [checked]="dashboardState.filters.dateRange"
                          [color]="'primary'">
        </mat-slide-toggle>
      </div>
      <ngx-datatable #table (page)="onPageChange($event)" (select)="onSelect($event)" (sort)="onSortChange($event.sorts[0])"
                     [columnMode]="'force'" [count]="executionEvents.totalCount" [externalPaging]="true" [externalSorting]="true"
                     [footerHeight]="'auto'" [headerHeight]="'auto'"
                     [limit]="dashboardState.pagination.size" [loadingIndicator]="loadingIndicator.isActive" [offset]="dashboardState.pagination.page - 1"
                     [rowHeight]="'auto'" [rows]="executionEvents.items" [scrollbarV]="false" [selectionType]="'single'"
                     [sorts]="[sort]" class='table material expandable'>

        <ngx-datatable-column [width]="10" name="Framework">
          <ng-template let-expanded="frameworkName" let-row="row" ngx-datatable-cell-template>
            <td class="frmw-icon frmw-icon-{{getFrameworkIconClass(row.frameworkName)}}"></td>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column [width]="50" name="Application Name" prop="applicationName">
          <ng-template let-expanded="applicationName" let-row="row" ngx-datatable-cell-template>
            <div class="tooltipCell" title="{{row.applicationName}}">
              {{row.applicationName}}
            </div>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column [width]="50" name="Application Id" prop="applicationId">
          <ng-template let-expanded="applicationId" let-row="row" ngx-datatable-cell-template>
            <div class="tooltipCell" title="{{row.applicationId}}">
              {{row.applicationId}}
            </div>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column [width]="50" name="Execution Date" prop="timestamp">
          <ng-template let-expanded="timestamp" let-row="row" ngx-datatable-cell-template>
            <div class="tooltipCell" placement="bottom" title=" {{row.timestamp | date:'yyyy-MM-dd, HH:mm:ss'}}">
              {{row.timestamp | date:'yyyy-MM-dd, HH:mm:ss'}}
            </div>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column [width]="400" name="Destination" prop="dataSourceUri">
          <ng-template let-expanded="dataSourceUri" let-row="row" ngx-datatable-cell-template>
            <div class="tooltipCell" title="{{row.dataSourceUri}}">
              {{row.dataSourceUri}}
            </div>
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column [width]="10" name="DataSource Type" prop="dataSourceType">
          <ng-template let-expanded="dataSourceType" let-row="row" ngx-datatable-cell-template>
            {{row.dataSourceType}}
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column [width]="10" name="Write Mode" prop="append">
          <ng-template let-expanded="append" let-row="row" ngx-datatable-cell-template>
            {{row.append && 'Append' || 'Override'}}
          </ng-template>
        </ngx-datatable-column>
        <!--Footer -->
        <ngx-datatable-footer>
          <ng-template let-isVisible="isVisible" let-pageSize="pageSize" let-rowCount="rowCount"
                       let-selectedCount="selectedCount" ngx-datatable-footer-template>
            <div *ngIf="(rowCount / pageSize) > 1" class="pager-bar-inner">
              <strong>Total</strong>: {{ rowCount }}
              <datatable-pager (change)="table.onFooterPage($event)"
                               [count]="rowCount" [page]="dashboardState.pagination.page"
                               [pagerLeftArrowIcon]="'datatable-icon-left'" [pagerNextIcon]="'datatable-icon-skip'" [pagerPreviousIcon]="'datatable-icon-prev'"
                               [pagerRightArrowIcon]="'datatable-icon-right'" [size]="pageSize">
              </datatable-pager>
            </div>
          </ng-template>
        </ngx-datatable-footer>

      </ngx-datatable>
    </div>
  </div>
</div>
